<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="content-type" content="text/html" charset="utf-8" />
    <title>Family Tree</title>
    <script src="family.js" type="text/javascript"></script>
    <script src="lookupTable.js"></script>
    <script src="data.js"></script>
    <style>
        .label {
            font-family: 'Arial', 'sans-serif';
            text-align: center;
            position: absolute;
            background-color: white;
            border: 2px solid black;
            border-radius: 6px;
            padding: 5px;
            cursor: pointer;
        }
        .label img { max-width: 70px; }
        .lifespan { font-size: 10pt; white-space: nowrap; }
        #control-panel {
            position: fixed;
            width: 100%;
            background: #f7f7f7;
            border-bottom: 1px solid black;
            z-index: 10;
            padding: 8px;
            top: 450px; /* Adjusted to fit below lunar-date and grid */
        }
        body {
            padding: 0;
            margin: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            background-color: #f0f0f0;
        }
        #lunar-date {
            font-size: 18px;
            padding: 10px;
            border: 2px solid #4682b4;
            border-radius: 8px;
            background-color: #e6f3fa;
            width: 100%;
            max-width: 100%;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            font-family: 'Arial', sans-serif;
            white-space: pre-wrap;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 10;
            box-sizing: border-box;
        }
        .grid-container {
            display: grid;
            grid-template-columns: 2fr 1fr; /* 2 unequal columns */
            gap: 20px;
            position: fixed;
            top: 150px; /* Moved down to fit lunar-date */
            width: 90%;
            max-width: 1200px;
            z-index: 5;
        }
        #lunar-info {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: black;
            padding: 10px;
            border-radius: 8px;
        }
        #login-panel, #subtree-input {
            text-align: center;
            margin: 10px;
        }
        #reminder {
            font-size: 16px;
            padding: 15px;
            width: 500px;
            margin-bottom: 10px;
            color: #8b0000;
            background: linear-gradient(to bottom, #fdf6e3, #f9e8b8);
            border: 3px double #8b4513;
            border-radius: 12px;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), inset 0 0 10px rgba(139, 69, 19, 0.1);
            font-family: 'Georgia', serif;
            white-space: pre-wrap;
            position: relative;
            overflow: hidden;
        }
        #reminder::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.2), transparent);
            pointer-events: none;
        }
        #candle-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 10px;
        }
        .candle {
            width: 100px;
            height: auto;
        }
        #canvas {
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1; /* Canvas behind candles */
        }
        button {
            padding: 8px 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover { background-color: #45a049; }
    </style>
</head>
<body>
    
    <div class="grid-container">
        <input type="text" id="lunar-date" readonly>
        <div id="lunar-info">
            <div id="candle-container">
                <img id="candle-left" class="candle" src="photos/web/0.png" alt="Candle Animation Left">
                <img class="candle" src="photos/web/bathuong.png" alt="Static Candle">
                <img id="candle-right" class="candle" src="photos/web/0.png" alt="Candle Animation Right">
                <canvas id="canvas"></canvas>
            </div>
            <div id="reminder"></div>
        </div>
        <div id="login-panel">
            <p>Enter password to view the family tree:</p>
            <input type="password" id="password-input">
            <button onclick="checkPassword()">Submit</button>
            <div id="subtree-input" style="display: none;">
                <p>Or enter a Person ID for a subtree:</p>
                <input type="number" id="id-input" placeholder="e.g., 1">
                <button onclick="showSubtree()">Show Subtree</button>
            </div>
        </div>
    </div>
    <div id="control-panel" style="display: none;">
        <div id="panel-top">
            <span>Family tree of <b><span id="root-name"></span></b></span>
            <span>and
                <select id="detail-picker" onchange="updateDetail()">
                    <option value="0">descendants, ancestors</option>
                    <option value="1">descendants, ancestors + their children, siblings</option>
                    <option value="2">descendants, ancestors + their grandchildren, cousins, nieces/nephews</option>
                    <option value="3">descendants, ancestors + their great-grandchildren, 2nd cousins</option>
                    <option value="Infinity" selected="selected">descendants, ancestors + all descendants of ancestors</option>
                    <option value="Everyone">everyone</option>
                </select>
            </span>
            <span id="tree-information"></span>
        </div>
        <div id="panel-bottom">
            <div id="info-pane-placeholder">
                <i>Hover your mouse on a person with <img src="info-icon.png" height="12px"> for their information</i>
                <br>See the <a target="_blank" href="https://github.com/daveagp/family-tree">source code</a> on GitHub
            </div>
            <div id="info-pane" style="display: none">About <i><span id="info-pane-name"></span></i>:
                <span id="info-pane-details"></span>
            </div>
        </div>
    </div>

    <script>
        const correctPassword = "Thuy";
        let familyData = datajs;

        function checkPassword() {
            const input = document.getElementById('password-input').value;
            if (input === correctPassword) {
                document.getElementById('login-panel').style.display = 'none';
                document.getElementById('control-panel').style.display = 'block';
                rootName = familyData[0]["Real Name"];
                if (typeof showRootName === 'function' && typeof drawTree === 'function' && window.state) {
                    showRootName();
                    drawTree(window.state.divs, window.state.neighbours);
                } else {
                    console.error('Family tree functions not available. Check family.js.');
                    document.body.innerHTML += '<p style="color:red;">Error: Family tree failed to load. Check console.</p>';
                }
            } else {
                alert("Incorrect password!");
                document.getElementById('subtree-input').style.display = 'block';
            }
        }

        function showSubtree() {
            const id = parseInt(document.getElementById('id-input').value);
            const person = familyData.find(p => p.ID === id);
            if (person) {
                document.getElementById('login-panel').style.display = 'none';
                document.getElementById('control-panel').style.display = 'block';
                rootName = person["Real Name"];
                if (typeof showRootName === 'function' && typeof drawTree === 'function' && window.state) {
                    showRootName();
                    drawTree(window.state.divs, window.state.neighbours);
                } else {
                    console.error('Family tree functions not available. Check family.js.');
                    document.body.innerHTML += '<p style="color:red;">Error: Family tree failed to load. Check console.</p>';
                }
            } else {
                alert("Invalid ID!");
            }
        }

        // Display today's normal and lunar date with custom format, and check for commemorations
        const today = new Date();
        const months = ["January", "February", "March", "April", "